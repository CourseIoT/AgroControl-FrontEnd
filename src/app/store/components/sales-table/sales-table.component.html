<!-- Stats Cards -->
<div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
  <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-4">
    <div class="flex items-center justify-between">
      <div>
        <p class="text-gray-600 text-xs font-medium mb-1">Total de Ventas</p>
        <p class="text-2xl font-bold text-gray-800">{{ dataSource.data.length }}</p>
      </div>
      <div class="bg-green-100 p-2.5 rounded-lg flex items-center justify-center">
        <mat-icon class="text-green-600 !w-6 !h-6 !text-2xl">receipt_long</mat-icon>
      </div>
    </div>
  </div>

  <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-4">
    <div class="flex items-center justify-between">
      <div>
        <p class="text-gray-600 text-xs font-medium mb-1">Ingresos Totales</p>
        <p class="text-2xl font-bold text-green-600">{{ getTotalIncome() | currency }}</p>
      </div>
      <div class="bg-teal-100 p-2.5 rounded-lg flex items-center justify-center">
        <mat-icon class="text-teal-600 !w-6 !h-6 !text-2xl">paid</mat-icon>
      </div>
    </div>
  </div>

  <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-4">
    <div class="flex items-center justify-between">
      <div>
        <p class="text-gray-600 text-xs font-medium mb-1">Productos Vendidos</p>
        <p class="text-2xl font-bold text-gray-800">{{ getTotalProductsSold() }}</p>
      </div>
      <div class="bg-blue-100 p-2.5 rounded-lg flex items-center justify-center">
        <mat-icon class="text-blue-600 !w-6 !h-6 !text-2xl">inventory</mat-icon>
      </div>
    </div>
  </div>
</div>

<!-- Search Bar -->
<div class="mb-6">
  <div class="relative max-w-xl">
    <mat-icon class="absolute left-4 top-1/2 transform -translate-y-1/2 text-gray-400 !text-xl">search</mat-icon>
    <input
      #input
      type="text"
      placeholder="Buscar por producto, comprador o fecha..."
      (keyup)="applyFilter($event)"
      class="w-full pl-12 pr-4 py-2.5 text-sm rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-teal-500 focus:border-transparent"
    />
  </div>
</div>

<!-- Table Card -->
<div class="bg-white rounded-lg shadow-sm border border-gray-200 overflow-hidden">
  <!-- Empty State -->
  <div *ngIf="dataSource.data.length === 0" class="p-12 text-center">
    <mat-icon class="text-gray-400 mb-4" style="font-size: 48px; width: 48px; height: 48px;">receipt_long</mat-icon>
    <p class="text-gray-500 text-base">No hay ventas registradas</p>
  </div>

  <!-- Table -->
  <div *ngIf="dataSource.data.length > 0" class="overflow-x-auto">
    <table mat-table [dataSource]="dataSource" class="w-full">
      <ng-container matColumnDef="date">
        <th mat-header-cell *matHeaderCellDef class="!bg-gray-50 !text-gray-700 !font-semibold !text-sm !py-4 !px-6">
          {{ 'shared.date' | translate }}
        </th>
        <td mat-cell *matCellDef="let element" class="!py-4 !px-6 !text-gray-800">
          {{element.date}}
        </td>
      </ng-container>

      <ng-container matColumnDef="product">
        <th mat-header-cell *matHeaderCellDef class="!bg-gray-50 !text-gray-700 !font-semibold !text-sm !py-4 !px-6">
          {{ 'products.product' | translate }}
        </th>
        <td mat-cell *matCellDef="let element" class="!py-4 !px-6 !text-gray-800 !font-medium">
          {{element.productName}}
        </td>
      </ng-container>

      <ng-container matColumnDef="quantity">
        <th mat-header-cell *matHeaderCellDef class="!bg-gray-50 !text-gray-700 !font-semibold !text-sm !py-4 !px-6">
          {{ 'resources.quantity' | translate }}
        </th>
        <td mat-cell *matCellDef="let element" class="!py-4 !px-6 !text-gray-800">
          <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-blue-100 text-blue-800">
            {{element.quantityProduct}}
          </span>
        </td>
      </ng-container>

      <ng-container matColumnDef="total">
        <th mat-header-cell *matHeaderCellDef class="!bg-gray-50 !text-gray-700 !font-semibold !text-sm !py-4 !px-6">
          {{ 'finances.total' | translate }}
        </th>
        <td mat-cell *matCellDef="let element" class="!py-4 !px-6 !text-green-600 !font-bold">
          ${{element.totalCostProduct.toFixed(2)}}
        </td>
      </ng-container>

      <ng-container matColumnDef="buyer">
        <th mat-header-cell *matHeaderCellDef class="!bg-gray-50 !text-gray-700 !font-semibold !text-sm !py-4 !px-6">
          {{ 'products.buyer' | translate }}
        </th>
        <td mat-cell *matCellDef="let element" class="!py-4 !px-6 !text-gray-800">
          <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-gray-100 text-gray-800">
            <mat-icon class="!text-sm !w-4 !h-4 mr-1">person</mat-icon>
            User {{element.userId}}
          </span>
        </td>
      </ng-container>

      <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
      <tr mat-row *matRowDef="let row; columns: displayedColumns;" class="hover:bg-gray-50 transition-colors"></tr>

      <!-- Row shown when there is no matching data -->
      <tr class="mat-row" *matNoDataRow>
        <td colspan="5" class="!text-center !py-8">
          <mat-icon class="text-gray-400 mb-2" style="font-size: 32px; width: 32px; height: 32px;">search_off</mat-icon>
          <p class="text-gray-500 text-sm">No se encontraron resultados para "{{ input.value }}"</p>
        </td>
      </tr>
    </table>
  </div>
</div>
